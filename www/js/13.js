(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"09ee":function(e,t,s){"use strict";s.r(t);s("a481"),s("ac6a"),s("cadf"),s("456d");var n=s("967e"),a=s.n(n),i=(s("551c"),s("06db"),s("96cf"),s("fa84")),r=s.n(i),o=(s("7f7f"),s("f559"),s("da34")),c=s.n(o),u=s("947b"),l=s.n(u),h=s("4386"),d="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",m={data:function(){return{picture:this.$store.state.user.picture?this.$store.state.user.picture.startsWith("http")?this.$store.state.user.picture:"data:"+this.$store.state.user.pictureFileType+";base64,"+this.$store.state.user.picture:d,pictureChanged:!1,userName:this.$store.state.user.name,emails:this.$store.state.user.contacts.filter((function(e){return e.isEmail})).map((function(e){return e.value})),addedEmails:[],removedEmails:[],phones:this.$store.state.user.contacts.filter((function(e){return!e.isEmail})).map((function(e){return e.value})),addedPhones:[],removedPhones:[],newEmail:"",newPhone:"",contactConsent:!!this.$store.state.user.contactConsent}},methods:{newPictureChanged:function(e){var t=this;return r()(a.a.mark((function s(){var n;return a.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(t.$q.loading.show(),"undefined"==typeof cordova||!cordova.plugins||!cordova.plugins.permissions){s.next=4;break}return s.next=4,new Promise((function(e,t){setTimeout(function e(){var t=this,s=cordova.plugins.permissions;s.requestPermission(s.READ_EXTERNAL_STORAGE,function(){var s=r()(a.a.mark((function s(n){return a.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(n.hasPermission){s.next=3;break}return setTimeout(e.bind(t),0),s.abrupt("return");case 3:t.resolve(n);case 4:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}(),(function(){return setTimeout(e.bind(t),0)}))}.bind({resolve:e,reject:t}),0)}));case 4:return s.prev=4,(n=new Image).onload=r()(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.width>500||n.height>500)){e.next=6;break}return e.next=3,c()(n.src,n.width>=n.height?500:0,n.height>=n.width?500:0);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=n.src;case 7:t.picture=e.t0,t.pictureChanged=!0;case 9:case"end":return e.stop()}}),e)}))),s.next=9,l.a.readAsDataURL(e.target.files[0]);case 9:n.src=s.sent,s.next=16;break;case 12:s.prev=12,s.t0=s.catch(4),console.log(s.t0),t.$q.notify({message:s.t0,timeout:2e3});case 16:return s.prev=16,t.$q.loading.hide(),s.finish(16);case 19:case"end":return s.stop()}}),s,null,[[4,12,16,19]])})))()},addEmail:function(){var e=this;if(/[A-Za-z0-9\-\_\.]+@([A-Za-z0-9\-\_]+\.)+[A-Za-z0-9\-\_]+/.test(this.newEmail))if(this.emails.indexOf(this.newEmail)>=0)this.$q.dialog({message:"This email has already been added."}).onOk((function(){return e.$refs.newEmailInput.focus()}));else{var t=this.removedEmails.indexOf(this.newEmail);t>=0?this.removedEmails.splice(t,1):this.addedEmails.push(this.newEmail),this.emails.push(this.newEmail),this.newEmail="",this.$refs.newEmailInput.focus()}else this.$q.dialog({message:"This is an invalid email address."}).onOk((function(){return e.$refs.newEmailInput.focus()}))},removeEmail:function(e){if(e!==this.$store.state.profile.email){var t=this.addedEmails.indexOf(e);t>=0?this.addedEmails.splice(t,1):this.removedEmails.push(e),this.emails.splice(this.emails.indexOf(e),1)}else this.$q.dialog({message:"This email is linked to your sign-in profile and cannot be removed."})},addPhone:function(){var e=this;if(/^\+?\d+$/.test(this.newPhone))if(this.phones.indexOf(this.newPhone)>=0)this.$q.dialog({message:"This phone number has already been added."}).onOk((function(){return e.$refs.newPhoneInput.focus()}));else{var t=this.removedPhones.indexOf(this.newPhone);t>=0?this.removedPhones.splice(t,1):this.addedPhones.push(this.newPhone),this.phones.push(this.newPhone),this.newPhone="",this.$refs.newPhoneInput.focus()}else this.$q.dialog({message:"This is an invalid phone number."}).onOk((function(){return e.$refs.newPhoneInput.focus()}))},removePhone:function(e){if(e!==this.$store.state.profile.phone_number){var t=this.addedPhones.indexOf(e);t>=0?this.addedPhones.splice(t,1):this.removedPhones.push(e),this.phones.splice(this.phones.indexOf(e),1)}else this.$q.dialog({message:"This phone number is linked to your sign-in profile and cannot be removed."})},update:function(){var e=this;return r()(a.a.mark((function t(){var s,n,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$q.loading.show(),s={},e.userName!==e.$store.state.user.name&&(s.name=e.userName),e.pictureChanged&&((n=e.picture.indexOf("base64,"))<0?n=e.picture.indexOf(";")+1:n+="base64,".length,s.picture=e.picture.substring(n),s.pictureFileType=e.picture.substring("data:".length,e.picture.indexOf(";"))),e.addedEmails.length>0&&(s.addedEmails=e.addedEmails),e.removedEmails.length>0&&(s.removedEmails=e.removedEmails),e.addedPhones.length>0&&(s.addedPhones=e.addedPhones),e.removedPhones.length>0&&(s.removedPhones=e.removedPhones),!!e.contactConsent!=!!e.$store.state.user.contactConsent&&(s.contactConsent=e.contactConsent?1:0),!(Object.keys(s).length<=0)){t.next=13;break}return e.$q.loading.hide(),e.$q.dialog({message:"Nothing to update"}),t.abrupt("return");case 13:return i=null,t.prev=14,t.next=17,h.a.getInstance().updateUser(s);case 17:return i=t.sent,t.next=20,h.a.getInstance().readUser();case 20:i=t.sent,e.$store.commit("user",i.data),e.$router.replace("/menu"),t.next=29;break;case 25:t.prev=25,t.t0=t.catch(14),console.log(t.t0),e.$q.notify({message:t.t0.message?t.t0.message:t.t0,timeout:2e3});case 29:return t.prev=29,e.$q.loading.hide(),t.finish(29);case 32:case"end":return t.stop()}}),t,null,[[14,25,29,32]])})))()},reset:function(){this.picture=this.$store.state.user.picture?this.$store.state.user.picture.startsWith("http")?this.$store.state.user.picture:"data:"+this.$store.state.user.pictureFileType+";base64,"+this.$store.state.user.picture:d,this.pictureChanged=!1,this.userName=this.$store.state.user.name,this.emails=this.$store.state.user.contacts.filter((function(e){return e.isEmail})).map((function(e){return e.value})),this.addedEmails=[],this.removedEmails=[],this.phones=this.$store.state.user.contacts.filter((function(e){return!e.isEmail})).map((function(e){return e.value})),this.addedPhones=[],this.removedPhones=[],this.newEmail="",this.newPhone="",this.contactConsent=this.$store.state.user.contactConsent,this.$forceUpdate()},cancel:function(){this.$router.replace("/menu")}}},p=(s("c23a"),s("2877")),f=Object(p.a)(m,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"page"},[s("q-item",{staticClass:"userPicture"},[s("label",{attrs:{for:"newPicture"}},[s("q-card",{staticClass:"userPicture"},[s("q-card-section",{staticClass:"userPicture"},[s("q-avatar",{staticClass:"userPicture",attrs:{rounded:"",size:"xl"}},[s("q-img",{attrs:{contain:"",src:e.picture}})],1)],1),s("q-card-section",{staticClass:"text-white"},[e._v("\n\t\t\t\t\tClick to change picture\n\t\t\t\t")])],1)],1),s("input",{ref:"newPicture",attrs:{type:"file",id:"newPicture",accept:"image/*"},on:{change:function(t){return e.newPictureChanged(t)}}})]),s("q-item",[s("q-input",{attrs:{dark:"",color:"white","label-color":"white",label:"Name"},model:{value:e.userName,callback:function(t){e.userName=t},expression:"userName"}})],1),s("q-item-label",{staticClass:"text-white",attrs:{header:""}},[e._v("Emails:")]),s("q-item",{staticClass:"emails text-white"},e._l(e.emails,(function(t){return s("q-chip",{staticClass:"glossy",attrs:{color:"red-10","text-color":"white",removable:""},on:{remove:function(s){return e.removeEmail(t)}}},[e._v(e._s(t))])})),1),s("q-form",[s("q-item",[s("q-input",{ref:"newEmailInput",attrs:{dark:"",color:"white","label-color":"white",type:"email",label:"New Email"},scopedSlots:e._u([{key:"append",fn:function(){return[s("q-btn",{attrs:{"no-caps":"",color:"red-10",glossy:"",push:"",type:"submit"},on:{click:e.addEmail}},[e._v("+")])]},proxy:!0}]),model:{value:e.newEmail,callback:function(t){e.newEmail=t},expression:"newEmail"}})],1)],1),s("q-item-label",{staticClass:"text-white",attrs:{header:""}},[e._v("Phone numbers:")]),s("q-item",{staticClass:"phones text-white"},e._l(e.phones,(function(t){return s("q-chip",{staticClass:"glossy",attrs:{color:"red-10","text-color":"white",removable:""},on:{remove:function(s){return e.removePhone(t)}}},[e._v(e._s(t))])})),1),s("q-form",[s("q-item",[s("q-input",{ref:"newPhoneInput",attrs:{dark:"",color:"white","label-color":"white",type:"phone",label:"New Phone Number"},scopedSlots:e._u([{key:"append",fn:function(){return[s("q-btn",{attrs:{"no-caps":"",color:"red-10",glossy:"",push:"",type:"submit"},on:{click:e.addPhone}},[e._v("+")])]},proxy:!0}]),model:{value:e.newPhone,callback:function(t){e.newPhone=t},expression:"newPhone"}})],1)],1),s("q-form",[s("q-item",[s("q-checkbox",{staticClass:"contactConsent",attrs:{size:"xs",label:"I consent to being contacted at my provided email address and/or phone number for any purpose whatsoever (including sending me promotional materials and important updates)."},model:{value:e.contactConsent,callback:function(t){e.contactConsent=t},expression:"contactConsent"}})],1)],1),s("q-item",[s("q-btn",{attrs:{"no-caps":"",color:"red-10",glossy:"",push:""},on:{click:e.update}},[e._v("\n\t\t\tUpdate!\n\t\t")]),s("q-btn",{attrs:{"no-caps":"",color:"red-10",glossy:"",push:""},on:{click:e.reset}},[e._v("\n\t\t\tReset\n\t\t")]),s("q-btn",{attrs:{"no-caps":"",color:"red-10",glossy:"",push:""},on:{click:e.cancel}},[e._v("\n\t\t\tCancel\n\t\t")])],1)],1)}),[],!1,null,"296a1016",null);t.default=f.exports},"3a3b":function(e,t,s){},c23a:function(e,t,s){"use strict";var n=s("3a3b");s.n(n).a}}]);